<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>luau: luau.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.2 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a></div>
<h1>luau.c</h1><a href="luau_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/*</span>
00002 <span class="comment"> * luau (Lib Update/Auto-Update): Simple Update Library</span>
00003 <span class="comment"> * Copyright (C) 2003  David Eklund</span>
00004 <span class="comment"> *</span>
00005 <span class="comment"> * - This library is free software; you can redistribute it and/or             -</span>
00006 <span class="comment"> * - modify it under the terms of the GNU Lesser General Public                -</span>
00007 <span class="comment"> * - License as published by the Free Software Foundation; either              -</span>
00008 <span class="comment"> * - version 2.1 of the License, or (at your option) any later version.        -</span>
00009 <span class="comment"> * -                                                                           -</span>
00010 <span class="comment"> * - This library is distributed in the hope that it will be useful,           -</span>
00011 <span class="comment"> * - but WITHOUT ANY WARRANTY; without even the implied warranty of            -</span>
00012 <span class="comment"> * - MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU         -</span>
00013 <span class="comment"> * - Lesser General Public License for more details.                           -</span>
00014 <span class="comment"> * -                                                                           -</span>
00015 <span class="comment"> * - You should have received a copy of the GNU Lesser General Public          -</span>
00016 <span class="comment"> * - License along with this library; if not, write to the Free Software       -</span>
00017 <span class="comment"> * - Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA -</span>
00018 <span class="comment"> */</span>
00019 
00028 <span class="comment">/* #define WITH_LEAKBUG 1 */</span>
00029 
00030 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00031 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00032 <span class="preprocessor">#include &lt;string.h&gt;</span>
00033 <span class="preprocessor">#include &lt;getopt.h&gt;</span>
00034 <span class="preprocessor">#include &lt;unistd.h&gt;</span>
00035 <span class="preprocessor">#include &lt;readline/readline.h&gt;</span>
00036 <span class="preprocessor">#include &lt;readline/history.h&gt;</span>
00037 
00038 <span class="preprocessor">#include &lt;glib.h&gt;</span>
00039 
00040 <span class="preprocessor">#include "<a class="code" href="libuau_8h.html">libuau.h</a>"</span>
00041 <span class="preprocessor">#include "<a class="code" href="util_8h.html">util.h</a>"</span>
00042 <span class="preprocessor">#include "<a class="code" href="error_8h.html">error.h</a>"</span>
00043 <span class="preprocessor">#include "<a class="code" href="parse_8h.html">parse.h</a>"</span>
00044 
00045 <span class="preprocessor">#ifdef WITH_DMALLOC</span>
00046 <span class="preprocessor"></span><span class="preprocessor">#  include &lt;dmalloc.h&gt;</span>
00047 <span class="preprocessor">#endif</span>
00048 <span class="preprocessor"></span>
00049 
<a name="l00050"></a><a class="code" href="luau_8c.html#a0">00050</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="luau_8c.html#a0">verbosity</a> = 1;
<a name="l00051"></a><a class="code" href="luau_8c.html#a1">00051</a> <span class="keyword">static</span> gboolean <a class="code" href="luau_8c.html#a1">outputToString</a> = FALSE;
<a name="l00052"></a><a class="code" href="luau_8c.html#a2">00052</a> <span class="keyword">static</span> GString *<a class="code" href="luau_8c.html#a2">outputString</a> = NULL;
00053 
00054 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="parseupdates_8c.html#a41">MSG</a>(<span class="keywordtype">int</span> level, <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">template</span>, ...) __attribute__ ((format (printf, 2, 3)));
00055 
00056 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="luau-register_8c.html#a0">printUsage</a>(<span class="keywordtype">void</span>);
00057 <span class="keyword">static</span> <span class="keyword">struct </span>option* <a class="code" href="luau_8c.html#a5">getLongOptions</a>(void);
00058 
00059 <span class="keyword">static</span> gboolean <a class="code" href="luau_8c.html#a6">downloadUpdate</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* ID, <span class="keyword">const</span> <span class="keywordtype">char</span>* filename, <span class="keyword">const</span> <span class="keywordtype">char</span>* program, APkgType type);
00060 <span class="keyword">static</span> gboolean <a class="code" href="luau_8c.html#a7">installUpdate</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* ID, <span class="keyword">const</span> <span class="keywordtype">char</span>* program, APkgType type);
00061 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="luau_8c.html#a8">getUpdates</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* program, APkgType type);
00062 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="luau_8c.html#a9">runInteractive</a>(<span class="keywordtype">void</span>); <span class="comment">/* const char* filename, const char* program, APkgType type); */</span>
00063 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="luau_8c.html#a10">printInteractiveHelp</a>(<span class="keywordtype">void</span>);
00064 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="luau_8c.html#a11">list</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* program);
00065 
00066 <span class="keyword">static</span> gint <a class="code" href="luau_8c.html#a12">compareUpdates</a>(gconstpointer p1, gconstpointer p2, gpointer data);
00067 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="luau_8c.html#a13">progressCallback</a>(<span class="keywordtype">void</span> *clientp, <span class="keywordtype">double</span> dltotal, <span class="keywordtype">double</span> dlnow, <span class="keywordtype">double</span> ultotal, <span class="keywordtype">double</span> ulnow);
00068 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="luau_8c.html#a14">prompt</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> * title, <span class="keyword">const</span> <span class="keywordtype">char</span>* msg, <span class="keywordtype">int</span> nTotal, <span class="keywordtype">int</span> nDefault, <span class="keyword">const</span> <span class="keywordtype">char</span> *choice1, va_list args);
00069 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="luau_8c.html#a15">send_email</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *to, <span class="keyword">const</span> <span class="keywordtype">char</span> *from, <span class="keyword">const</span> <span class="keywordtype">char</span> *subject, <span class="keyword">const</span> <span class="keywordtype">char</span> *message);
00070 
00071 <span class="keywordtype">int</span>
<a name="l00072"></a><a class="code" href="luau_8c.html#a16">00072</a> <a class="code" href="test_8c.html#a0">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[]) {
00073         <span class="keywordtype">int</span> mode = 0, c, n = -1, ret = 0;
00074         <span class="keywordtype">char</span> *<a class="code" href="parseupdates_8c.html#a94">file</a> = NULL, *program = NULL, *typeName = NULL, *arg = NULL, *email = NULL;
00075         <a class="code" href="libuau_8h.html#a10">APkgType</a> type = <a class="code" href="libuau_8h.html#a3">LUAU_EMPTY</a>;
00076         <span class="keyword">struct </span>option* longOptions = <a class="code" href="luau-register_8c.html#a1">getLongOptions</a>();
00077         
00078         <span class="keywordflow">while</span> ((c = getopt_long(argc, argv, <span class="stringliteral">":d:e:gilhm:o:p:t:vq"</span>, longOptions, NULL)) != -1) {
00079                 <span class="keywordflow">switch</span> (c) {
00080                         <span class="keywordflow">case</span> <span class="charliteral">'d'</span>:
00081                         <span class="keywordflow">case</span> <span class="charliteral">'e'</span>:
00082                                 arg = g_strdup(optarg);
00083                         <span class="keywordflow">case</span> <span class="charliteral">'g'</span>:
00084                         <span class="keywordflow">case</span> <span class="charliteral">'i'</span>:
00085                         <span class="keywordflow">case</span> <span class="charliteral">'l'</span>:
00086                                 <span class="keywordflow">if</span> (mode == 0) {
00087                                         mode = c;
00088                                 } <span class="keywordflow">else</span> {
00089                                         <a class="code" href="error_8h.html#a1">ERROR</a>(<span class="stringliteral">"Can only do one operation at a time"</span>);
00090                                         <a class="code" href="luau-register_8c.html#a0">printUsage</a>();
00091                                         exit(1);
00092                                 }
00093                                 <span class="keywordflow">break</span>;
00094                                 
00095                         <span class="keywordflow">case</span> <span class="charliteral">'m'</span>:
00096                                 email = g_strdup(optarg);
00097                                 <a class="code" href="luau_8c.html#a1">outputToString</a> = TRUE;
00098                                 <a class="code" href="luau_8c.html#a2">outputString</a> = g_string_new(<span class="stringliteral">""</span>);
00099                                 <span class="keywordflow">break</span>;
00100                         <span class="keywordflow">case</span> <span class="charliteral">'o'</span>:
00101                                 <a class="code" href="parseupdates_8c.html#a94">file</a> = g_strdup(optarg);
00102                                 <span class="keywordflow">break</span>;
00103                         <span class="keywordflow">case</span> <span class="charliteral">'p'</span>:
00104                                 program = g_strdup(optarg);
00105                                 <span class="keywordflow">break</span>;
00106                         <span class="keywordflow">case</span> <span class="charliteral">'t'</span>:
00107                                 typeName = g_strdup(optarg);
00108                                 <span class="keywordflow">break</span>;
00109                         <span class="keywordflow">case</span> <span class="charliteral">'h'</span>:
00110                                 <a class="code" href="luau-register_8c.html#a0">printUsage</a>();
00111                                 exit(0);
00112                         <span class="keywordflow">case</span> <span class="charliteral">'q'</span>:
00113                                 --<a class="code" href="luau_8c.html#a0">verbosity</a>;
00114                                 <span class="keywordflow">break</span>;
00115                         <span class="keywordflow">case</span> <span class="charliteral">'v'</span>:
00116                                 ++<a class="code" href="luau_8c.html#a0">verbosity</a>;
00117                                 <span class="keywordflow">break</span>;
00118                         <span class="keywordflow">case</span> <span class="charliteral">'?'</span>:
00119                                 <a class="code" href="error_8h.html#a1">ERROR</a>(<span class="stringliteral">"Invalid option: -%c"</span>, optopt);
00120                                 <a class="code" href="luau-register_8c.html#a0">printUsage</a>();
00121                                 exit(1);
00122                         <span class="keywordflow">case</span> <span class="charliteral">':'</span>:
00123                                 <a class="code" href="error_8h.html#a1">ERROR</a>(<span class="stringliteral">"Argument needed for -%c"</span>, optopt);
00124                                 <a class="code" href="luau-register_8c.html#a0">printUsage</a>();
00125                                 exit(1);
00126                         <span class="keywordflow">default</span>:
00127                                 <a class="code" href="error_8h.html#a1">ERROR</a>(<span class="stringliteral">"Unknown error: got character code 0%o"</span>, c);
00128                                 <a class="code" href="luau-register_8c.html#a0">printUsage</a>();
00129                                 exit(1);
00130                 }
00131         }
00132         
00133         g_free(longOptions);
00134         
00135         <span class="keywordflow">if</span> (<a class="code" href="luau_8c.html#a0">verbosity</a> &gt; 0 &amp;&amp; email == NULL) {
00136                 <a class="code" href="libuau_8c.html#a19">luau_registerProgressCallback</a>(<a class="code" href="luau_8c.html#a13">progressCallback</a>);
00137                 <a class="code" href="libuau_8c.html#a18">luau_registerPromptFunc</a>(<a class="code" href="luau_8c.html#a14">prompt</a>);
00138         }
00139 
00140         
00141         <span class="keywordflow">if</span> (mode == 0) {
00142                 mode = <span class="charliteral">'i'</span>;
00143         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mode == <span class="charliteral">'d'</span> || mode == <span class="charliteral">'e'</span>) {
00144                 <span class="keywordflow">if</span> (program == NULL) {
00145                         <a class="code" href="error_8h.html#a1">ERROR</a>(<span class="stringliteral">"Must specify a program name to download or install updates."</span>);
00146                         <a class="code" href="luau-register_8c.html#a0">printUsage</a>();
00147                         exit(1);
00148                 }
00149                 <span class="keywordflow">if</span> (typeName == NULL) {
00150                         <a class="code" href="error_8h.html#a1">ERROR</a>(<span class="stringliteral">"Must specify a package type to download or install updates."</span>);
00151                         <a class="code" href="luau-register_8c.html#a0">printUsage</a>();
00152                         exit(1);
00153                 }
00154         }
00155         
00156         <span class="keywordflow">if</span> (typeName != NULL) {
00157                 <span class="keywordflow">if</span> ((type = <a class="code" href="libuau_8c.html#a30">luau_parsePkgType</a>(typeName)) == <a class="code" href="libuau_8h.html#a9">LUAU_UNKNOWN</a>)
00158                         <a class="code" href="error_8h.html#a1">ERROR</a>(<span class="stringliteral">"Unknown package type: %s"</span>, typeName);
00159         }
00160         
00161         <span class="keywordflow">switch</span> (mode) {
00162                 <span class="keywordflow">case</span> <span class="charliteral">'d'</span>:
00163                         <a class="code" href="luau_8c.html#a6">downloadUpdate</a>(arg, <a class="code" href="parseupdates_8c.html#a94">file</a>, program, type);
00164                         <span class="keywordflow">break</span>;
00165                 <span class="keywordflow">case</span> <span class="charliteral">'e'</span>:
00166                         <span class="keywordflow">if</span> (<a class="code" href="parseupdates_8c.html#a94">file</a> != NULL) 
00167                                 <a class="code" href="parseupdates_8c.html#a41">MSG</a>(1, <span class="stringliteral">"WARNING: filename specified, but ignored for install mode\n"</span>);
00168                         <a class="code" href="luau_8c.html#a7">installUpdate</a>(arg, program, type);
00169                         <span class="keywordflow">break</span>;
00170                 <span class="keywordflow">case</span> <span class="charliteral">'g'</span>:
00171                         <span class="keywordflow">if</span> (<a class="code" href="parseupdates_8c.html#a94">file</a> != NULL)
00172                                 <a class="code" href="parseupdates_8c.html#a41">MSG</a>(1, <span class="stringliteral">"WARNING: filename specified, but ignored for getupdate mode\n"</span>);
00173                         n = <a class="code" href="luau_8c.html#a8">getUpdates</a>(program, type);
00174                         <span class="keywordflow">break</span>;
00175                 <span class="keywordflow">case</span> <span class="charliteral">'i'</span>:
00176                         <a class="code" href="luau_8c.html#a9">runInteractive</a>(); <span class="comment">/* file, program, type); */</span>
00177                         <span class="keywordflow">break</span>;
00178                 <span class="keywordflow">case</span> <span class="charliteral">'l'</span>:
00179                         <span class="keywordflow">if</span> (<a class="code" href="parseupdates_8c.html#a94">file</a> != NULL)
00180                                 <a class="code" href="parseupdates_8c.html#a41">MSG</a>(1, <span class="stringliteral">"WARNING: filename specified, but ignored for list mode\n"</span>);
00181                         <span class="keywordflow">if</span> (type != <a class="code" href="libuau_8h.html#a3">LUAU_EMPTY</a>)
00182                                 <a class="code" href="parseupdates_8c.html#a41">MSG</a>(1, <span class="stringliteral">"WARNING: package type specified, but ignored for list mode\n"</span>);
00183                         ret = <a class="code" href="luau_8c.html#a11">list</a>(program);
00184                         <span class="keywordflow">break</span>;
00185                 <span class="keywordflow">default</span>:
00186                         <a class="code" href="error_8h.html#a1">ERROR</a>(<span class="stringliteral">"Unrecognized mode: %c"</span>, mode);
00187                         exit(1);
00188         }
00189         
00190         <span class="keywordflow">if</span> (email != NULL &amp;&amp; <a class="code" href="luau_8c.html#a2">outputString</a> != NULL &amp;&amp; <a class="code" href="luau_8c.html#a2">outputString</a>-&gt;len &gt; 0) {
00191                 GString *temp;
00192                 <span class="keywordtype">char</span> subject[255];
00193                 
00194                 <span class="keywordflow">if</span> (mode == <span class="charliteral">'g'</span>) {
00195                         temp = g_string_new(<span class="stringliteral">""</span>);
00196                         g_string_printf(temp, <span class="stringliteral">"There are %d new updates available.\n\n"</span>, n);
00197                         g_string_prepend(<a class="code" href="luau_8c.html#a2">outputString</a>, temp-&gt;str);
00198                         g_string_free(temp, TRUE);
00199                         
00200                         <span class="keywordflow">if</span> (program == NULL)
00201                                 snprintf(subject, 255, <span class="stringliteral">"Luau: %d New Updates Available"</span>, n);
00202                         <span class="keywordflow">else</span>
00203                                 snprintf(subject, 255, <span class="stringliteral">"Luau: %d New Updates Available For '%s'"</span>, n, program);
00204                 } <span class="keywordflow">else</span> {
00205                         snprintf(subject, 255, <span class="stringliteral">"Luau: Report"</span>);
00206                 }
00207                 
00208                 <a class="code" href="luau_8c.html#a15">send_email</a>(email, <span class="stringliteral">"luau@localhost"</span>, subject, <a class="code" href="luau_8c.html#a2">outputString</a>-&gt;str);
00209         }
00210                 
00211         g_free(<a class="code" href="parseupdates_8c.html#a94">file</a>);
00212         g_free(email);
00213         g_free(program);
00214         g_free(typeName);
00215         g_free(arg);
00216         
00217 <span class="preprocessor">#ifdef WITH_LEAKBUG</span>
00218 <span class="preprocessor"></span>        lbDumpLeaks();
00219 <span class="preprocessor">#endif</span>
00220 <span class="preprocessor"></span>
00221         <span class="keywordflow">return</span> ret;
00222 }
00223 
00224 <span class="keyword">static</span> gboolean
<a name="l00225"></a><a class="code" href="luau_8c.html#a6">00225</a> <a class="code" href="luau_8c.html#a6">downloadUpdate</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* ID, <span class="keyword">const</span> <span class="keywordtype">char</span>* filename, <span class="keyword">const</span> <span class="keywordtype">char</span>* program, APkgType type) {
00226         <a class="code" href="structAProgInfo.html">AProgInfo</a> progInfo;
00227         <a class="code" href="structAUpdate.html">AUpdate</a> update;
00228         gboolean result;
00229         <span class="keyword">const</span> <span class="keywordtype">char</span> *downloadTo;
00230         
00231         result = <a class="code" href="libuau_8c.html#a4">luau_getProgInfo</a>(&amp;progInfo, program);
00232         <span class="keywordflow">if</span> (result == FALSE) {
00233                 <a class="code" href="error_8h.html#a1">ERROR</a>(<span class="stringliteral">"No such program '%s'"</span>, program);
00234                 <span class="keywordflow">return</span> FALSE;
00235         }
00236         
00237         result = <a class="code" href="libuau_8c.html#a5">luau_getUpdateInfo</a>(&amp;update, ID, &amp;progInfo);
00238         <span class="keywordflow">if</span> (result == FALSE) {
00239                 <a class="code" href="error_8h.html#a1">ERROR</a>(<span class="stringliteral">"No such update '%s' for program '%s'"</span>, ID, program);
00240                 <span class="keywordflow">return</span> FALSE;
00241         }
00242         
00243         result = TRUE;
00244         <span class="keywordflow">if</span> (update.<a class="code" href="structAUpdate.html#o2">type</a> == <a class="code" href="libuau_8h.html#a69a17">LUAU_SOFTWARE</a>) {
00245                 <span class="keywordflow">if</span> (filename != NULL &amp;&amp; filename[0] != <span class="charliteral">'\0'</span>)
00246                         downloadTo = filename;
00247                 <span class="keywordflow">else</span>
00248                         downloadTo = <span class="stringliteral">"."</span>;
00249                 
00250                 <a class="code" href="util_8h.html#a1">DBUGOUT</a>(<span class="stringliteral">"Downloading update '%s' for '%s' to '%s'"</span>, ID, program, downloadTo);
00251                 downloadTo = <a class="code" href="libuau_8c.html#a9">luau_downloadUpdate</a>(&amp;progInfo, &amp;update, type, downloadTo);
00252                 
00253                 <span class="keywordflow">if</span> (downloadTo == NULL) {
00254                         <a class="code" href="error_8h.html#a1">ERROR</a>(<span class="stringliteral">"Couldn't download update '%s' for '%s'"</span>, ID, program);
00255                         result = FALSE;
00256                 } <span class="keywordflow">else</span> {
00257                         <a class="code" href="parseupdates_8c.html#a41">MSG</a>(1, <span class="stringliteral">"Downloaded update '%s' to %s\n"</span>, ID, downloadTo);
00258                         result = TRUE;
00259                 }
00260         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (update.<a class="code" href="structAUpdate.html#o2">type</a> == <a class="code" href="libuau_8h.html#a69a18">LUAU_MESSAGE</a>) {
00261                 <a class="code" href="parseupdates_8c.html#a41">MSG</a>(1, <span class="stringliteral">"ID: %s\n"</span>, ID);
00262                 <a class="code" href="parseupdates_8c.html#a41">MSG</a>(1, <span class="stringliteral">"Brief: %s\n"</span>, update.<a class="code" href="structAUpdate.html#o4">shortDesc</a>);
00263                 <a class="code" href="parseupdates_8c.html#a41">MSG</a>(1, <span class="stringliteral">"Full:\n"</span>);
00264                 <a class="code" href="util_8c.html#a9">lutil_printIndented</a>(2, 80, update.<a class="code" href="structAUpdate.html#o5">fullDesc</a>);
00265         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (update.<a class="code" href="structAUpdate.html#o2">type</a> == <a class="code" href="libuau_8h.html#a69a19">LUAU_LIBUPDATE</a>) {
00266                 <a class="code" href="parseupdates_8c.html#a41">MSG</a>(1, <span class="stringliteral">"ID: %s\n"</span>, ID);
00267                 <a class="code" href="parseupdates_8c.html#a41">MSG</a>(1, <span class="stringliteral">"Brief: %s\n"</span>, update.<a class="code" href="structAUpdate.html#o4">shortDesc</a>);
00268                 <a class="code" href="parseupdates_8c.html#a41">MSG</a>(1, <span class="stringliteral">"Full:\n"</span>);
00269                 <span class="keywordflow">if</span> (<a class="code" href="luau_8c.html#a0">verbosity</a> &gt;= 1)
00270                         <a class="code" href="util_8c.html#a9">lutil_printIndented</a>(2, 80, update.<a class="code" href="structAUpdate.html#o5">fullDesc</a>);
00271                 <a class="code" href="parseupdates_8c.html#a41">MSG</a>(0, <span class="stringliteral">"New URL: %s\n"</span>, update.<a class="code" href="structAUpdate.html#o13">newURL</a>);
00272         }
00273         
00274         <a class="code" href="libuau_8c.html#a50">luau_freeProgInfo</a>(&amp;progInfo);
00275         <a class="code" href="libuau_8c.html#a51">luau_freeUpdateInfo</a>(&amp;update);
00276         
00277         <span class="keywordflow">return</span> result;
00278 }
00279 
00280 <span class="keyword">static</span> gboolean
<a name="l00281"></a><a class="code" href="luau_8c.html#a7">00281</a> <a class="code" href="luau_8c.html#a7">installUpdate</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* ID, <span class="keyword">const</span> <span class="keywordtype">char</span>* program, APkgType type) {
00282         <a class="code" href="structAProgInfo.html">AProgInfo</a> progInfo;
00283         <a class="code" href="structAUpdate.html">AUpdate</a> updateInfo;
00284         gboolean result;
00285         
00286         result = <a class="code" href="libuau_8c.html#a4">luau_getProgInfo</a>(&amp;progInfo, program);
00287         <span class="keywordflow">if</span> (result == FALSE) {
00288                 <a class="code" href="error_8h.html#a1">ERROR</a>(<span class="stringliteral">"No such program '%s'"</span>, program);
00289                 <span class="keywordflow">return</span> FALSE;
00290         }
00291         
00292         result = <a class="code" href="libuau_8c.html#a5">luau_getUpdateInfo</a>(&amp;updateInfo, ID, &amp;progInfo);
00293         <span class="keywordflow">if</span> (result == FALSE) {
00294                 <a class="code" href="error_8h.html#a1">ERROR</a>(<span class="stringliteral">"No such update '%s' for program '%s'"</span>, ID, program);
00295                 <span class="keywordflow">return</span> FALSE;
00296         }
00297         
00298         <span class="keywordflow">if</span> (updateInfo.<a class="code" href="structAUpdate.html#o2">type</a> == <a class="code" href="libuau_8h.html#a69a17">LUAU_SOFTWARE</a>) {
00299                 result = <a class="code" href="libuau_8c.html#a8">luau_installUpdate</a>(&amp;progInfo, &amp;updateInfo, type);
00300                 <span class="keywordflow">if</span> (result)
00301                         <a class="code" href="parseupdates_8c.html#a41">MSG</a>(1, <span class="stringliteral">"Done.\n"</span>);
00302                 <span class="keywordflow">else</span>
00303                         <a class="code" href="error_8h.html#a1">ERROR</a>(<span class="stringliteral">"Couldn't install update '%s' for '%s'"</span>, ID, program);
00304         } <span class="keywordflow">else</span> {
00305                 <a class="code" href="parseupdates_8c.html#a41">MSG</a>(1, <span class="stringliteral">"Installing new software repository location...\n"</span>);
00306                 <a class="code" href="parseupdates_8c.html#a41">MSG</a>(1, updateInfo.<a class="code" href="structAUpdate.html#o13">newURL</a>);
00307                 progInfo.<a class="code" href="structAProgInfo.html#o4">url</a> = updateInfo.<a class="code" href="structAUpdate.html#o13">newURL</a>;
00308                 result = <a class="code" href="libuau_8c.html#a15">luau_registerNewApp</a>(&amp;progInfo);
00309                 <span class="keywordflow">if</span> (result)
00310                         <a class="code" href="parseupdates_8c.html#a41">MSG</a>(1, <span class="stringliteral">"Done.\n"</span>);
00311                 <span class="keywordflow">else</span>
00312                         <a class="code" href="error_8h.html#a1">ERROR</a>(<span class="stringliteral">"Couldn't register new URL - do you have necessary permissions?"</span>);
00313         }
00314         
00315         <a class="code" href="libuau_8c.html#a50">luau_freeProgInfo</a>(&amp;progInfo);
00316         <a class="code" href="libuau_8c.html#a51">luau_freeUpdateInfo</a>(&amp;updateInfo);
00317         
00318         <span class="keywordflow">return</span> result;
00319 }
00320 
00321 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00322"></a><a class="code" href="luau_8c.html#a8">00322</a> <a class="code" href="luau_8c.html#a8">getUpdates</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* program, APkgType type) {
00323         <a class="code" href="structAProgInfo.html">AProgInfo</a> info;
00324         GPtrArray *<a class="code" href="parseupdates_8c.html#a88">updates</a>, *allUpdates, *progs;
00325         <span class="keyword">const</span> <span class="keywordtype">char</span>* updateType;
00326         <span class="keywordtype">char</span> *packageType, *desc;
00327         <a class="code" href="structAUpdate.html">AUpdate</a> *<a class="code" href="parseupdates_8c.html#a90">curr</a>;
00328         gboolean result;
00329         <span class="keywordtype">int</span> i, j, n, nUpdates = 0, max_len = 4;
00330         
00331         allUpdates = g_ptr_array_new();
00332         
00333         <span class="keywordflow">if</span> (program == NULL) {
00334                 progs = <a class="code" href="libuau_8c.html#a7">luau_getAllPrograms</a>();
00335                 <span class="keywordflow">if</span> (progs == NULL) {
00336                         <a class="code" href="error_8h.html#a1">ERROR</a>(<span class="stringliteral">"Couldn't retrieve list of registered programs: exiting"</span>);
00337                         exit(1);
00338                 }
00339                 <span class="keywordflow">for</span> (i = 0; i &lt; progs-&gt;len; ++i) {
00340                         program = g_ptr_array_index(progs, i);
00341                         result = <a class="code" href="libuau_8c.html#a4">luau_getProgInfo</a>(&amp;info, program);
00342                         <span class="keywordflow">if</span> (result == FALSE) {
00343                                 <a class="code" href="error_8h.html#a1">ERROR</a>(<span class="stringliteral">"Couldn't get information for '%s'"</span>, program);
00344                                 <span class="keywordflow">return</span> 1;
00345                         }
00346                         <a class="code" href="parseupdates_8c.html#a88">updates</a> = <a class="code" href="libuau_8c.html#a6">luau_checkForUpdates</a>(&amp;info);
00347                         <span class="keywordflow">if</span> (<a class="code" href="parseupdates_8c.html#a88">updates</a> == NULL) {
00348                                 <a class="code" href="error_8h.html#a1">ERROR</a>(<span class="stringliteral">"Couldn't retrieve updates for %s"</span>, program);
00349                                 <span class="keywordflow">return</span> 1;
00350                         }
00351                         <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="parseupdates_8c.html#a88">updates</a>-&gt;len; ++j) {
00352                                 <a class="code" href="parseupdates_8c.html#a90">curr</a> = g_ptr_array_index(<a class="code" href="parseupdates_8c.html#a88">updates</a>, j);
00353                                 <span class="keywordflow">if</span> ((n = strlen(<a class="code" href="parseupdates_8c.html#a90">curr</a>-&gt;<a class="code" href="structAUpdate.html#o0">id</a>)) &gt; max_len) {
00354                                         max_len = n;
00355                                 }
00356                         }
00357                         nUpdates += <a class="code" href="parseupdates_8c.html#a88">updates</a>-&gt;len;
00358                         g_ptr_array_add(allUpdates, <a class="code" href="parseupdates_8c.html#a88">updates</a>);
00359                         <a class="code" href="libuau_8c.html#a50">luau_freeProgInfo</a>(&amp;info);
00360                 }
00361                 program = NULL;
00362         } <span class="keywordflow">else</span> {
00363                 result = <a class="code" href="libuau_8c.html#a4">luau_getProgInfo</a>(&amp;info, program);
00364                 <span class="keywordflow">if</span> (result == FALSE) {
00365                         <a class="code" href="error_8h.html#a1">ERROR</a>(<span class="stringliteral">"Couldn't get information for %s"</span>, program);
00366                         <span class="keywordflow">return</span> 1;
00367                 }
00368                 <a class="code" href="parseupdates_8c.html#a88">updates</a> = <a class="code" href="libuau_8c.html#a6">luau_checkForUpdates</a>(&amp;info);
00369                 <span class="keywordflow">if</span> (<a class="code" href="parseupdates_8c.html#a88">updates</a> == NULL) {
00370                         <a class="code" href="error_8h.html#a1">ERROR</a>(<span class="stringliteral">"Couldn't retrieve updates for %s"</span>, program);
00371                         <span class="keywordflow">return</span> 1;
00372                 }
00373                 <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="parseupdates_8c.html#a88">updates</a>-&gt;len; ++i) {
00374                         <a class="code" href="parseupdates_8c.html#a90">curr</a> = g_ptr_array_index(<a class="code" href="parseupdates_8c.html#a88">updates</a>, i);
00375                         <span class="keywordflow">if</span> ((n = strlen(<a class="code" href="parseupdates_8c.html#a90">curr</a>-&gt;<a class="code" href="structAUpdate.html#o0">id</a>)) &gt; max_len) {
00376                                 max_len = n;
00377                         }
00378                 }
00379                 nUpdates = <a class="code" href="parseupdates_8c.html#a88">updates</a>-&gt;len;
00380                 g_ptr_array_add(allUpdates, <a class="code" href="parseupdates_8c.html#a88">updates</a>);
00381                 
00382                 progs = g_ptr_array_new();
00383                 g_ptr_array_add(progs, g_strdup(program));
00384                 <a class="code" href="libuau_8c.html#a50">luau_freeProgInfo</a>(&amp;info);
00385         }
00386         
00387         <span class="comment">//g_ptr_array_sort_with_data(updates, compareUpdates, (gpointer) "type");</span>
00388         
00389         <a class="code" href="parseupdates_8c.html#a41">MSG</a>(2, <span class="stringliteral">"%d Updates Available:\n"</span>, nUpdates);
00390         <a class="code" href="parseupdates_8c.html#a41">MSG</a>(1, <span class="stringliteral">"%-*s Type      Formats            Description\n"</span>, max_len, <span class="stringliteral">"Name"</span>);
00391         <a class="code" href="parseupdates_8c.html#a41">MSG</a>(1, <span class="stringliteral">"--------------------------------------------------------------------------------\n"</span>);
00392                 
00393         <span class="keywordflow">for</span> (j = 0; j &lt; allUpdates-&gt;len; ++j) {
00394                 <a class="code" href="parseupdates_8c.html#a88">updates</a> = g_ptr_array_index(allUpdates, j);
00395                         
00396                 <span class="keywordflow">if</span> (program == NULL || <a class="code" href="luau_8c.html#a0">verbosity</a> &gt;= 2) {
00397                         <span class="keywordflow">if</span> (j != 0)
00398                                 <a class="code" href="parseupdates_8c.html#a41">MSG</a>(0, <span class="stringliteral">"\n"</span>);
00399                         <span class="keywordflow">if</span> (!<a class="code" href="luau_8c.html#a1">outputToString</a>)
00400                                 <a class="code" href="parseupdates_8c.html#a41">MSG</a>(0, <span class="stringliteral">"================================================================================\r"</span>);
00401                         <a class="code" href="parseupdates_8c.html#a41">MSG</a>(0, <span class="stringliteral">"==========================&gt; %s &lt;\n"</span>, (<span class="keywordtype">char</span>*) g_ptr_array_index(progs, j));
00402                 }
00403                 
00404                 <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="parseupdates_8c.html#a88">updates</a>-&gt;len; ++i) {
00405                         <a class="code" href="parseupdates_8c.html#a90">curr</a> = g_ptr_array_index(<a class="code" href="parseupdates_8c.html#a88">updates</a>, i);
00406                         <span class="keywordflow">if</span> (<a class="code" href="libuau_8c.html#a40">luau_isHidden</a>(<a class="code" href="parseupdates_8c.html#a90">curr</a>) || <a class="code" href="libuau_8c.html#a39">luau_isIncompatible</a>(<a class="code" href="parseupdates_8c.html#a90">curr</a>))
00407                                 <span class="keywordflow">continue</span>;
00408                         
00409                         updateType = <a class="code" href="libuau_8c.html#a33">luau_updateTypeString</a>(<a class="code" href="parseupdates_8c.html#a90">curr</a>-&gt;<a class="code" href="structAUpdate.html#o2">type</a>);
00410                         <span class="keywordflow">if</span> (<a class="code" href="parseupdates_8c.html#a90">curr</a>-&gt;<a class="code" href="structAUpdate.html#o2">type</a> == <a class="code" href="libuau_8h.html#a69a17">LUAU_SOFTWARE</a>)
00411                                 packageType = <a class="code" href="libuau_8c.html#a28">luau_multPackageTypeString</a>(<a class="code" href="parseupdates_8c.html#a90">curr</a>-&gt;<a class="code" href="structAUpdate.html#o8">availableFormats</a>);
00412                         <span class="keywordflow">else</span> 
00413                                 packageType = <span class="stringliteral">""</span>;
00414                         
00415                         desc = (<a class="code" href="parseupdates_8c.html#a90">curr</a>-&gt;<a class="code" href="structAUpdate.html#o4">shortDesc</a> == NULL ? <span class="stringliteral">"(none)"</span> : <a class="code" href="parseupdates_8c.html#a90">curr</a>-&gt;<a class="code" href="structAUpdate.html#o4">shortDesc</a>);
00416         
00417                         <a class="code" href="parseupdates_8c.html#a41">MSG</a>(0, <span class="stringliteral">"%-*s %-9s %-18s %s\n"</span>, max_len, <a class="code" href="parseupdates_8c.html#a90">curr</a>-&gt;<a class="code" href="structAUpdate.html#o0">id</a>, updateType, packageType, <a class="code" href="parseupdates_8c.html#a90">curr</a>-&gt;<a class="code" href="structAUpdate.html#o4">shortDesc</a>);
00418                         
00419                         <span class="keywordflow">if</span> (<a class="code" href="parseupdates_8c.html#a90">curr</a>-&gt;<a class="code" href="structAUpdate.html#o2">type</a> == <a class="code" href="libuau_8h.html#a69a17">LUAU_SOFTWARE</a>)
00420                                 g_free(packageType);
00421                 }
00422                 <a class="code" href="libuau_8c.html#a49">luau_freeUpdateArray</a>(<a class="code" href="parseupdates_8c.html#a88">updates</a>);
00423         }
00424         
00425         g_ptr_array_free(allUpdates, TRUE);
00426         g_ptr_array_free(progs, TRUE);
00427         
00428         <span class="keywordflow">return</span> 0;
00429 }
00430 
00431 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00432"></a><a class="code" href="luau_8c.html#a9">00432</a> <a class="code" href="luau_8c.html#a9">runInteractive</a>(<span class="keywordtype">void</span>) { <span class="comment">/* const char* filename, const char* program, APkgType type) { */</span>
00433         <a class="code" href="structLUAU__parsedLine.html">LUAU_parsedLine</a> *line;
00434         GPtrArray *symbols;
00435         <span class="keywordtype">char</span> *input, *programID, *updateID, *filename;
00436         <a class="code" href="libuau_8h.html#a10">APkgType</a> type;
00437         
00438         symbols = g_ptr_array_new();
00439         g_ptr_array_add(symbols, <span class="stringliteral">"help"</span>);
00440         g_ptr_array_add(symbols, GINT_TO_POINTER (<span class="charliteral">'h'</span>));
00441         g_ptr_array_add(symbols, <span class="stringliteral">"get"</span>);
00442         g_ptr_array_add(symbols, GINT_TO_POINTER (<span class="charliteral">'g'</span>));
00443         g_ptr_array_add(symbols, <span class="stringliteral">"install"</span>);
00444         g_ptr_array_add(symbols, GINT_TO_POINTER (<span class="charliteral">'i'</span>));
00445         g_ptr_array_add(symbols, <span class="stringliteral">"list"</span>);
00446         g_ptr_array_add(symbols, GINT_TO_POINTER (<span class="charliteral">'l'</span>));
00447         g_ptr_array_add(symbols, <span class="stringliteral">"updates"</span>);
00448         g_ptr_array_add(symbols, GINT_TO_POINTER (<span class="charliteral">'u'</span>));
00449         g_ptr_array_add(symbols, <span class="stringliteral">"quit"</span>);
00450         g_ptr_array_add(symbols, GINT_TO_POINTER (<span class="charliteral">'q'</span>));
00451         
00452         <a class="code" href="parseupdates_8c.html#a41">MSG</a>(1, <span class="stringliteral">"luau %d.%d.%d - Automatically update supported software.\n"</span>, <a class="code" href="libuau_8h.html#a0">LUAU_VERSION_MAJOR</a>, <a class="code" href="libuau_8h.html#a1">LUAU_VERSION_MINOR</a>, <a class="code" href="libuau_8h.html#a2">LUAU_VERSION_PATCH</a>);
00453         <a class="code" href="parseupdates_8c.html#a41">MSG</a>(1, <span class="stringliteral">"Copyright (c) 2003, David Eklund\n"</span>);
00454         <a class="code" href="parseupdates_8c.html#a41">MSG</a>(1, <span class="stringliteral">"All rights reserved.\n"</span>);
00455         <a class="code" href="parseupdates_8c.html#a41">MSG</a>(1, <span class="stringliteral">"\n"</span>);
00456         <a class="code" href="parseupdates_8c.html#a41">MSG</a>(1, <span class="stringliteral">"Type 'help' for help.\n"</span>);
00457         
00458         <span class="keywordflow">while</span> ((input = readline(<span class="stringliteral">"&gt; "</span>)) != NULL) {
00459                 <span class="keywordflow">if</span> (input[0] == <span class="charliteral">'\0'</span>)
00460                         <span class="keywordflow">continue</span>;
00461                 add_history(input);
00462                 
00463                 line = <a class="code" href="parse_8c.html#a0">lutil_parse_parseLine</a>(input);
00464                 <span class="keywordflow">switch</span> (<a class="code" href="parse_8c.html#a1">lutil_parse_parseSymbol</a>(line-&gt;<a class="code" href="structLUAU__parsedLine.html#o0">keyword</a>, symbols)) {
00465                         <span class="keywordflow">case</span> <span class="charliteral">'h'</span>:
00466                                 <a class="code" href="luau_8c.html#a10">printInteractiveHelp</a>();
00467                                 <span class="keywordflow">break</span>;
00468                                 
00469                         <span class="keywordflow">case</span> <span class="charliteral">'g'</span>:
00470                                 <span class="keywordflow">if</span> (line-&gt;<a class="code" href="structLUAU__parsedLine.html#o1">args</a>-&gt;len &lt; 2)
00471                                         <a class="code" href="error_8h.html#a1">ERROR</a>(<span class="stringliteral">"Not enough arguments given"</span>);
00472                                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (line-&gt;<a class="code" href="structLUAU__parsedLine.html#o1">args</a>-&gt;len &gt; 4)
00473                                         <a class="code" href="error_8h.html#a1">ERROR</a>(<span class="stringliteral">"Too many arguments given"</span>);
00474                                 <span class="keywordflow">else</span> {
00475                                         programID = g_ptr_array_index(line-&gt;<a class="code" href="structLUAU__parsedLine.html#o1">args</a>, 0);
00476                                         updateID  = g_ptr_array_index(line-&gt;<a class="code" href="structLUAU__parsedLine.html#o1">args</a>, 1);
00477                                         <span class="keywordflow">if</span> (line-&gt;<a class="code" href="structLUAU__parsedLine.html#o1">args</a>-&gt;len &gt; 2)
00478                                                 type  = <a class="code" href="libuau_8c.html#a30">luau_parsePkgType</a>(g_ptr_array_index(line-&gt;<a class="code" href="structLUAU__parsedLine.html#o1">args</a>, 2));
00479                                         <span class="keywordflow">else</span>
00480                                                 type = <a class="code" href="libuau_8h.html#a3">LUAU_EMPTY</a>;
00481                                         
00482                                         <span class="keywordflow">if</span> (line-&gt;<a class="code" href="structLUAU__parsedLine.html#o1">args</a>-&gt;len &gt; 3)
00483                                                 filename = g_ptr_array_index(line-&gt;<a class="code" href="structLUAU__parsedLine.html#o1">args</a>, 3);
00484                                         <span class="keywordflow">else</span>
00485                                                 filename = NULL;
00486                                         
00487                                         <a class="code" href="luau_8c.html#a6">downloadUpdate</a>(updateID, filename, programID, type);
00488                                 }
00489                                 <span class="keywordflow">break</span>;
00490                         
00491                         <span class="keywordflow">case</span> <span class="charliteral">'i'</span>:
00492                                 <span class="keywordflow">if</span> (line-&gt;<a class="code" href="structLUAU__parsedLine.html#o1">args</a>-&gt;len &lt; 3)
00493                                         <a class="code" href="error_8h.html#a1">ERROR</a>(<span class="stringliteral">"Not enough arguments given"</span>);
00494                                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (line-&gt;<a class="code" href="structLUAU__parsedLine.html#o1">args</a>-&gt;len &gt; 3)
00495                                         <a class="code" href="error_8h.html#a1">ERROR</a>(<span class="stringliteral">"Too many arguments given"</span>);
00496                                 <span class="keywordflow">else</span> {
00497                                         programID = g_ptr_array_index(line-&gt;<a class="code" href="structLUAU__parsedLine.html#o1">args</a>, 0);
00498                                         updateID  = g_ptr_array_index(line-&gt;<a class="code" href="structLUAU__parsedLine.html#o1">args</a>, 1);
00499                                         type      = <a class="code" href="libuau_8c.html#a30">luau_parsePkgType</a>(g_ptr_array_index(line-&gt;<a class="code" href="structLUAU__parsedLine.html#o1">args</a>, 2));
00500                                         
00501                                         <a class="code" href="luau_8c.html#a7">installUpdate</a>(updateID, programID, type);
00502                                 }
00503                                 <span class="keywordflow">break</span>;
00504                         
00505                         <span class="keywordflow">case</span> <span class="charliteral">'l'</span>:
00506                                 <span class="keywordflow">if</span> (line-&gt;<a class="code" href="structLUAU__parsedLine.html#o1">args</a>-&gt;len &gt; 1)
00507                                         <a class="code" href="error_8h.html#a1">ERROR</a>(<span class="stringliteral">"Not enough arguments given"</span>);
00508                                 <span class="keywordflow">else</span> {
00509                                         <span class="keywordflow">if</span> (line-&gt;<a class="code" href="structLUAU__parsedLine.html#o1">args</a>-&gt;len == 1)
00510                                                 programID = g_ptr_array_index(line-&gt;<a class="code" href="structLUAU__parsedLine.html#o1">args</a>, 0);
00511                                         <span class="keywordflow">else</span>
00512                                                 programID = NULL;
00513                                         
00514                                         <a class="code" href="luau_8c.html#a11">list</a>(programID);
00515                                 }
00516                                 <span class="keywordflow">break</span>;
00517                         
00518                         <span class="keywordflow">case</span> <span class="charliteral">'u'</span>:
00519                                 <span class="keywordflow">if</span> (line-&gt;<a class="code" href="structLUAU__parsedLine.html#o1">args</a>-&gt;len &lt; 1)
00520                                         <a class="code" href="error_8h.html#a1">ERROR</a>(<span class="stringliteral">"Not enough arguments given"</span>);
00521                                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (line-&gt;<a class="code" href="structLUAU__parsedLine.html#o1">args</a>-&gt;len &gt; 1)
00522                                         <a class="code" href="error_8h.html#a1">ERROR</a>(<span class="stringliteral">"Too many arguments given"</span>);
00523                                 <span class="keywordflow">else</span> {
00524                                         programID = g_ptr_array_index(line-&gt;<a class="code" href="structLUAU__parsedLine.html#o1">args</a>, 0);
00525                                         
00526                                         <a class="code" href="luau_8c.html#a8">getUpdates</a>(programID, <a class="code" href="libuau_8h.html#a3">LUAU_EMPTY</a>);
00527                                 }
00528                                 <span class="keywordflow">break</span>;
00529                         
00530                         <span class="keywordflow">case</span> <span class="charliteral">'q'</span>:
00531                                 <a class="code" href="parse_8c.html#a3">lutil_parse_freeParsedLine</a>(line);
00532                                 <span class="keywordflow">goto</span> END;
00533                         
00534                         <span class="keywordflow">default</span>:
00535                                 <a class="code" href="error_8h.html#a1">ERROR</a>(<span class="stringliteral">"Parse error: unrecognized command '%s'"</span>, line-&gt;<a class="code" href="structLUAU__parsedLine.html#o0">keyword</a>);
00536                 }
00537                 
00538                 <a class="code" href="parse_8c.html#a3">lutil_parse_freeParsedLine</a>(line);
00539         }
00540 
00541 END:
00542         <a class="code" href="parseupdates_8c.html#a41">MSG</a>(0, <span class="stringliteral">"\n"</span>);
00543 }
00544 
00545 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00546"></a><a class="code" href="luau_8c.html#a10">00546</a> <a class="code" href="luau_8c.html#a10">printInteractiveHelp</a>(<span class="keywordtype">void</span>) {
00547         <a class="code" href="parseupdates_8c.html#a41">MSG</a>(0, <span class="stringliteral">"List of commands:\n\n"</span>);
00548         
00549         <a class="code" href="parseupdates_8c.html#a41">MSG</a>(0, <span class="stringliteral">"get &lt;PROGRAM-ID&gt; &lt;UPDATE-ID&gt; [&lt;PACKAGE-TYPE&gt;] [&lt;FILENAME&gt;]\n"</span>);
00550         <a class="code" href="parseupdates_8c.html#a41">MSG</a>(0, <span class="stringliteral">" - Retrieve a update of type PACKAGE-TYPE and download it to FILENAME\n"</span>);
00551         <a class="code" href="parseupdates_8c.html#a41">MSG</a>(0, <span class="stringliteral">"   (if specified), or the current directory (if not).\n"</span>);
00552         <a class="code" href="parseupdates_8c.html#a41">MSG</a>(0, <span class="stringliteral">"install &lt;PROGRAM-ID&gt; &lt;UPDATE-ID&gt; [&lt;PACKAGE-TYPE&gt;]\n"</span>);
00553         <a class="code" href="parseupdates_8c.html#a41">MSG</a>(0, <span class="stringliteral">" - Retrieve and install an update of type PACKAGE-TYPE.\n"</span>);
00554         <a class="code" href="parseupdates_8c.html#a41">MSG</a>(0, <span class="stringliteral">"list [&lt;PROGRAM-ID&gt;]\n"</span>);
00555         <a class="code" href="parseupdates_8c.html#a41">MSG</a>(0, <span class="stringliteral">" - If PROGRAM-ID is specified, show whether it is registered.  Otherwise,\n"</span>);
00556         <a class="code" href="parseupdates_8c.html#a41">MSG</a>(0, <span class="stringliteral">"   list all registered programs.\n"</span>);
00557         <a class="code" href="parseupdates_8c.html#a41">MSG</a>(0, <span class="stringliteral">"updates &lt;PROGRAM-ID&gt;\n"</span>);
00558         <a class="code" href="parseupdates_8c.html#a41">MSG</a>(0, <span class="stringliteral">" - Retrieve and list all updates available for PROGRAM-ID\n"</span>);
00559         <a class="code" href="parseupdates_8c.html#a41">MSG</a>(0, <span class="stringliteral">"quit\n"</span>);
00560         <a class="code" href="parseupdates_8c.html#a41">MSG</a>(0, <span class="stringliteral">" - Quit luau and return to command prompt\n\n"</span>);
00561         
00562         <a class="code" href="parseupdates_8c.html#a41">MSG</a>(0, <span class="stringliteral">"Note that for PACKAGE-TYPE, you must enter one of the following:\n"</span>);
00563         <a class="code" href="parseupdates_8c.html#a41">MSG</a>(0, <span class="stringliteral">"  RPM DEB SRC EXEC\n"</span>);
00564 }
00565 
00566 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00567"></a><a class="code" href="luau_8c.html#a11">00567</a> <a class="code" href="luau_8c.html#a11">list</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* program) {
00568         <span class="keywordtype">int</span> i, ret = 0;
00569         <span class="keywordtype">char</span> *progName, *url, *desc, *nameAndVersion;
00570         gboolean found = FALSE, result;
00571         GPtrArray *allPrograms;
00572         <a class="code" href="structAProgInfo.html">AProgInfo</a> info;
00573                 
00574         allPrograms = <a class="code" href="libuau_8c.html#a7">luau_getAllPrograms</a>();
00575         <span class="keywordflow">if</span> (program != NULL) {
00576                 <a class="code" href="parseupdates_8c.html#a41">MSG</a>(2, <span class="stringliteral">"Checking if '%s' is registered... "</span>, program);
00577                 <span class="keywordflow">for</span> (i = 0; i &lt; allPrograms-&gt;len; ++i) {
00578                         <span class="keywordflow">if</span> (<a class="code" href="util_8c.html#a0">lutil_streq</a>(program, g_ptr_array_index(allPrograms, i))) {
00579                                 found = TRUE;
00580                                 <span class="keywordflow">break</span>;
00581                         }
00582                 }
00583                 
00584                 <span class="keywordflow">if</span> (found) {
00585                         <a class="code" href="parseupdates_8c.html#a41">MSG</a>(2, <span class="stringliteral">"Yes.\n"</span>);
00586                         <a class="code" href="parseupdates_8c.html#a41">MSG</a>(1, <span class="stringliteral">"%s\n"</span>, program);
00587                         ret = 0;
00588                 } <span class="keywordflow">else</span> {
00589                         <a class="code" href="parseupdates_8c.html#a41">MSG</a>(2, <span class="stringliteral">"No\n"</span>);
00590                         ret = 1;
00591                 }
00592         } <span class="keywordflow">else</span> {
00593                 <a class="code" href="parseupdates_8c.html#a41">MSG</a>(1, <span class="stringliteral">"--------------------------------------------------------------------------------\n"</span>);
00594                 <a class="code" href="parseupdates_8c.html#a41">MSG</a>(1, <span class="stringliteral">" * Name            Description\n"</span>);
00595                 <a class="code" href="parseupdates_8c.html#a41">MSG</a>(1, <span class="stringliteral">"   URL\n"</span>);
00596                 <a class="code" href="parseupdates_8c.html#a41">MSG</a>(1, <span class="stringliteral">"--------------------------------------------------------------------------------\n"</span>);
00597                 <span class="keywordflow">for</span> (i = 0; i &lt; allPrograms-&gt;len; ++i) {
00598                         progName = g_ptr_array_index(allPrograms, i);
00599                         <span class="keywordflow">if</span> (<a class="code" href="luau_8c.html#a0">verbosity</a> &gt; 0) {
00600                                 result = <a class="code" href="libuau_8c.html#a4">luau_getProgInfo</a>(&amp;info, progName);
00601                                 
00602                                 <span class="keywordflow">if</span> (result == FALSE)
00603                                         <a class="code" href="error_8h.html#a0">FATAL_ERROR</a>(<span class="stringliteral">"INTERNAL ERROR: program registered, but couldn't retrieve information"</span>);
00604                                 
00605                                 url = (info.<a class="code" href="structAProgInfo.html#o4">url</a> == NULL ? <span class="stringliteral">"(none)"</span> : info.<a class="code" href="structAProgInfo.html#o4">url</a>);
00606                                 desc = (info.<a class="code" href="structAProgInfo.html#o3">desc</a> == NULL ? <span class="stringliteral">"(none)"</span> : info.<a class="code" href="structAProgInfo.html#o3">desc</a>);
00607                                 
00608                                 <span class="keywordflow">if</span> (info.<a class="code" href="structAProgInfo.html#o5">version</a> == NULL)
00609                                         nameAndVersion = g_strdup(info.<a class="code" href="structAProgInfo.html#o1">shortname</a>);
00610                                 <span class="keywordflow">else</span>
00611                                         nameAndVersion = <a class="code" href="util_8c.html#a3">lutil_vstrcreate</a>(info.<a class="code" href="structAProgInfo.html#o1">shortname</a>, <span class="stringliteral">" "</span>, info.<a class="code" href="structAProgInfo.html#o5">version</a>, NULL);
00612                                 
00613                                 <a class="code" href="parseupdates_8c.html#a41">MSG</a>(0, <span class="stringliteral">" * %-15s %s\n"</span>, nameAndVersion, desc);
00614                                 <a class="code" href="parseupdates_8c.html#a41">MSG</a>(0, <span class="stringliteral">"   %s\n\n"</span>, url);
00615                                 
00616                                 <a class="code" href="libuau_8c.html#a50">luau_freeProgInfo</a>(&amp;info);
00617                         } <span class="keywordflow">else</span> {
00618                                 <a class="code" href="parseupdates_8c.html#a41">MSG</a>(0, <span class="stringliteral">"%s\n"</span>, (<span class="keywordtype">char</span>*) g_ptr_array_index(allPrograms, i));
00619                         }
00620                 }
00621                 ret = 0;
00622         }
00623         
00624         <a class="code" href="util_8c.html#a17">lutil_destroyArray</a>(allPrograms);
00625         
00626         <span class="keywordflow">return</span> ret;
00627 }
00628 
00629 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00630"></a><a class="code" href="luau_8c.html#a4">00630</a> <a class="code" href="luau-register_8c.html#a0">printUsage</a>() {
00631         <a class="code" href="parseupdates_8c.html#a41">MSG</a>(0, <span class="stringliteral">"Usage: luau [OPTIONS]...\n"</span>);
00632         <a class="code" href="parseupdates_8c.html#a41">MSG</a>(0, <span class="stringliteral">"\n"</span>);
00633         <a class="code" href="parseupdates_8c.html#a41">MSG</a>(0, <span class="stringliteral">"Options:\n"</span>);
00634         <a class="code" href="parseupdates_8c.html#a41">MSG</a>(0, <span class="stringliteral">"  Modes: (only one may be specified)\n"</span>);
00635         <a class="code" href="parseupdates_8c.html#a41">MSG</a>(0, <span class="stringliteral">"  -d, --download=ID     download update with given ID for specified program\n"</span>);
00636         <a class="code" href="parseupdates_8c.html#a41">MSG</a>(0, <span class="stringliteral">"  -e, --install=ID      install update with given ID for specified program\n"</span>);
00637         <a class="code" href="parseupdates_8c.html#a41">MSG</a>(0, <span class="stringliteral">"  -g, --getupdates      retrieve a list of new updates\n"</span>);
00638         <a class="code" href="parseupdates_8c.html#a41">MSG</a>(0, <span class="stringliteral">"  -i, --interactive     run in interactive mode [default]\n"</span>);
00639         <a class="code" href="parseupdates_8c.html#a41">MSG</a>(0, <span class="stringliteral">"  -l, --list            list all registered programs\n"</span>);
00640         <a class="code" href="parseupdates_8c.html#a41">MSG</a>(0, <span class="stringliteral">"  -h, --help            display this message\n"</span>);
00641         <a class="code" href="parseupdates_8c.html#a41">MSG</a>(0, <span class="stringliteral">"\n"</span>);
00642         <a class="code" href="parseupdates_8c.html#a41">MSG</a>(0, <span class="stringliteral">"  Extra Information:\n"</span>);
00643         <a class="code" href="parseupdates_8c.html#a41">MSG</a>(0, <span class="stringliteral">"  -m, --email=ADDRESS   email the results to ADDRESS, if any results at all\n"</span>);
00644         <a class="code" href="parseupdates_8c.html#a41">MSG</a>(0, <span class="stringliteral">"  -o, --output=PATH     when downloading an update, specify where to download\n"</span>);
00645         <a class="code" href="parseupdates_8c.html#a41">MSG</a>(0, <span class="stringliteral">"  -p, --program=NAME    specify a program\n"</span>);
00646         <a class="code" href="parseupdates_8c.html#a41">MSG</a>(0, <span class="stringliteral">"  -t, --type=TYPE       specify the type of update to download/install\n"</span>);
00647         <a class="code" href="parseupdates_8c.html#a41">MSG</a>(0, <span class="stringliteral">"  -q, --quiet           suppress all unnecessary output\n"</span>);
00648         <a class="code" href="parseupdates_8c.html#a41">MSG</a>(0, <span class="stringliteral">"  -v, --verbose         display more informational output\n"</span>);
00649         <a class="code" href="parseupdates_8c.html#a41">MSG</a>(0, <span class="stringliteral">"\n"</span>);
00650         <a class="code" href="parseupdates_8c.html#a41">MSG</a>(0, <span class="stringliteral">"To download or install updates, both the program name and the type to download\n"</span>);
00651         <a class="code" href="parseupdates_8c.html#a41">MSG</a>(0, <span class="stringliteral">"MUST be specified.\n"</span>);
00652         <a class="code" href="parseupdates_8c.html#a41">MSG</a>(0, <span class="stringliteral">"\n"</span>);
00653 }
00654 
00655 
00656 <span class="keyword">static</span> <span class="keyword">struct </span>option *
<a name="l00657"></a><a class="code" href="luau_8c.html#a5">00657</a> <a class="code" href="luau_8c.html#a5">getLongOptions</a>() {
00658         <span class="keyword">struct </span>option *options = (<span class="keyword">struct </span>option *) g_malloc(15 * sizeof(struct option));
00659         
00660         options[0].name = <span class="stringliteral">"download"</span>;
00661         options[0].has_arg = 1;
00662         options[0].flag = NULL;
00663         options[0].val = <span class="charliteral">'d'</span>;
00664         
00665         options[1].name = <span class="stringliteral">"install"</span>;
00666         options[1].has_arg = 1;
00667         options[1].flag = NULL;
00668         options[1].val = <span class="charliteral">'e'</span>;
00669         
00670         options[2].name = <span class="stringliteral">"getupdates"</span>;
00671         options[2].has_arg = 0;
00672         options[2].flag = NULL;
00673         options[2].val = <span class="charliteral">'g'</span>;
00674 
00675         options[3].name = <span class="stringliteral">"interactive"</span>;
00676         options[3].has_arg = 0;
00677         options[3].flag = NULL;
00678         options[3].val = <span class="charliteral">'i'</span>;
00679         
00680         options[4].name = <span class="stringliteral">"list"</span>;
00681         options[4].has_arg = 0;
00682         options[4].flag = NULL;
00683         options[4].val = <span class="charliteral">'l'</span>;
00684         
00685         options[5].name = <span class="stringliteral">"help"</span>;
00686         options[5].has_arg = 0;
00687         options[5].flag = NULL;
00688         options[5].val = <span class="charliteral">'h'</span>;
00689         
00690         options[6].name = <span class="stringliteral">"program"</span>;
00691         options[6].has_arg = 1;
00692         options[6].flag = NULL;
00693         options[6].val = <span class="charliteral">'p'</span>;
00694         
00695         options[10].name = <span class="stringliteral">"output"</span>;
00696         options[10].has_arg = 1;
00697         options[10].flag = NULL;
00698         options[10].val = <span class="charliteral">'o'</span>;
00699         
00700         options[11].name = <span class="stringliteral">"email"</span>;
00701         options[11].has_arg = 1;
00702         options[11].flag = NULL;
00703         options[11].val = <span class="charliteral">'m'</span>;
00704                 
00705         options[7].name = <span class="stringliteral">"type"</span>;
00706         options[7].has_arg = 0;
00707         options[7].flag = NULL;
00708         options[7].val = <span class="charliteral">'t'</span>;
00709         
00710         options[8].name = <span class="stringliteral">"quiet"</span>;
00711         options[8].has_arg = 0;
00712         options[8].flag = NULL;
00713         options[8].val = <span class="charliteral">'q'</span>;
00714         
00715         options[9].name = <span class="stringliteral">"verbose"</span>;
00716         options[9].has_arg = 0;
00717         options[9].flag = NULL;
00718         options[9].val = <span class="charliteral">'v'</span>;
00719         
00720         memset(&amp;options[12], 0, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> option));
00721         
00722         <span class="keywordflow">return</span> options;
00723 }
00724 
00725 
00726 <span class="keyword">static</span> gint
<a name="l00727"></a><a class="code" href="luau_8c.html#a12">00727</a> <a class="code" href="luau_8c.html#a12">compareUpdates</a>(gconstpointer p1, gconstpointer p2, gpointer data) {
00728         <span class="comment">/* Used by g_ptr_array_sort */</span>
00729         <a class="code" href="structAUpdate.html">AUpdate</a> *u1 = (<a class="code" href="structAUpdate.html">AUpdate</a>*) p1, *u2 = (<a class="code" href="structAUpdate.html">AUpdate</a>*) p2;
00730         <span class="keywordtype">char</span>* sortBy = (<span class="keywordtype">char</span>*) data;
00731         
00732         <span class="keywordflow">if</span> (<a class="code" href="util_8c.html#a1">lutil_strcaseeq</a>(sortBy, <span class="stringliteral">"type"</span>))
00733                 <span class="keywordflow">return</span> <a class="code" href="util_8c.html#a14">lutil_intcmp</a>(u1-&gt;<a class="code" href="structAUpdate.html#o2">type</a>, u2-&gt;type);
00734         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="util_8c.html#a1">lutil_strcaseeq</a>(sortBy, <span class="stringliteral">"date"</span>))
00735                 <span class="keywordflow">return</span> <a class="code" href="libuau_8c.html#a26">luau_datecmp</a>(u1-&gt;<a class="code" href="structAUpdate.html#o3">date</a>, u2-&gt;date);
00736         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="util_8c.html#a1">lutil_strcaseeq</a>(sortBy, <span class="stringliteral">"id"</span>))
00737                 <span class="keywordflow">return</span> strcmp(u1-&gt;<a class="code" href="structAUpdate.html#o0">id</a>, u2-&gt;id);
00738         <span class="keywordflow">else</span>
00739                 <a class="code" href="error_8h.html#a1">ERROR</a>(<span class="stringliteral">"Unrecognized sort-by type: %s"</span>, sortBy);
00740         
00741         <span class="keywordflow">return</span> 0;
00742 }
00743 
00744 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00745"></a><a class="code" href="luau_8c.html#a13">00745</a> <a class="code" href="luau_8c.html#a13">progressCallback</a>(<span class="keywordtype">void</span> *clientp, <span class="keywordtype">double</span> dltotal, <span class="keywordtype">double</span> dlnow, <span class="keywordtype">double</span> ultotal, <span class="keywordtype">double</span> ulnow) {
00746         <span class="keywordtype">float</span> fract;
00747         <span class="keywordtype">int</span> i, n;
00748         
00749         <span class="keywordflow">if</span> (dltotal != 0) {
00750                 fract = (dlnow / dltotal);
00751                 n = fract * 50;
00752                 
00753                 printf(<span class="stringliteral">"\r"</span>);
00754                 <span class="keywordflow">for</span> (i = 0; i &lt; n; ++i)
00755                         printf(<span class="stringliteral">"#"</span>);
00756                 <span class="keywordflow">for</span> (i = n; i &lt; 50; ++i)
00757                         printf(<span class="stringliteral">"."</span>);
00758                 
00759                 printf(<span class="stringliteral">" : %d/%d (%d%%)"</span>, (<span class="keywordtype">int</span>)dlnow, (<span class="keywordtype">int</span>)dltotal, (<span class="keywordtype">int</span>) (fract * 100));
00760                 
00761                 <span class="keywordflow">if</span> (dlnow == dltotal)
00762                         printf(<span class="stringliteral">"\n"</span>);
00763                 
00764                 fflush(stdout);
00765         }
00766         
00767         <span class="keywordflow">return</span> 0;
00768 }
00769 
00770 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00771"></a><a class="code" href="luau_8c.html#a14">00771</a> <a class="code" href="luau_8c.html#a14">prompt</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> * title, <span class="keyword">const</span> <span class="keywordtype">char</span>* msg, <span class="keywordtype">int</span> nTotal, <span class="keywordtype">int</span> nDefault, <span class="keyword">const</span> <span class="keywordtype">char</span> *choice1, va_list args) {
00772         <span class="keyword">const</span> <span class="keywordtype">char</span> *choice;
00773         <span class="keywordtype">char</span> <a class="code" href="luau_8c.html#a14">prompt</a>[30], *input;
00774         <span class="keywordtype">int</span> i, selection = 0;
00775         
00776         <a class="code" href="parseupdates_8c.html#a41">MSG</a>(0, <span class="stringliteral">"\n"</span>);
00777         <a class="code" href="parseupdates_8c.html#a41">MSG</a>(0, <span class="stringliteral">"%s:\n"</span>, title);
00778         <a class="code" href="parseupdates_8c.html#a41">MSG</a>(0, <span class="stringliteral">"%s\n\n"</span>, msg);
00779         
00780         <a class="code" href="parseupdates_8c.html#a41">MSG</a>(0, <span class="stringliteral">"1) %s\n"</span>, choice1);
00781         
00782         <span class="keywordflow">for</span> (i = 1; i &lt; nTotal; ++i) {
00783                 choice = va_arg(args, <span class="keyword">const</span> <span class="keywordtype">char</span> *);
00784                 <a class="code" href="parseupdates_8c.html#a41">MSG</a>(0, <span class="stringliteral">"%d) %s\n"</span>, i+1, choice);
00785         }
00786         <a class="code" href="parseupdates_8c.html#a41">MSG</a>(0, <span class="stringliteral">"\n"</span>);
00787         
00788         <span class="keywordflow">while</span> (selection &lt; 1 || selection &gt; nTotal) {
00789                 snprintf(<a class="code" href="luau_8c.html#a14">prompt</a>, 30, <span class="stringliteral">"Choice [%d]: "</span>, nDefault+1);
00790                 input = readline(<a class="code" href="luau_8c.html#a14">prompt</a>);
00791                 <span class="keywordflow">if</span> (input[0] == <span class="charliteral">'\0'</span>)
00792                         selection = nDefault+1;
00793                 <span class="keywordflow">else</span>
00794                         selection = atoi(input);
00795         }
00796         
00797         <a class="code" href="parseupdates_8c.html#a41">MSG</a>(0, <span class="stringliteral">"\n"</span>);
00798         
00799         <span class="keywordflow">return</span> selection-1;
00800 }
00801 
00802 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00803"></a><a class="code" href="luau_8c.html#a15">00803</a> <a class="code" href="luau_8c.html#a15">send_email</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *to, <span class="keyword">const</span> <span class="keywordtype">char</span> *from, <span class="keyword">const</span> <span class="keywordtype">char</span> *subject, <span class="keyword">const</span> <span class="keywordtype">char</span> *message)
00804 {
00805         <span class="keywordtype">char</span> *exec, *subject_c, *msg_c, *ptr;
00806         <span class="keywordtype">int</span> <a class="code" href="parseupdates_8c.html#a95">len</a>;
00807         
00808         <a class="code" href="parseupdates_8c.html#a95">len</a> = strlen(subject) + strlen(message) + 255;
00809         exec = <a class="code" href="util_8c.html#a2">lutil_createString</a>(<a class="code" href="parseupdates_8c.html#a95">len</a>);
00810         
00811         subject_c = g_strdup(subject);
00812         msg_c = g_strdup(message);
00813         
00814         ptr = msg_c;
00815         <span class="keywordflow">while</span> ( (ptr =  strchr(ptr, <span class="charliteral">'\''</span>)) != NULL) {
00816                 ptr[0] = <span class="charliteral">'"'</span>;
00817                 ++ptr;
00818         }
00819         ptr = subject_c;
00820         <span class="keywordflow">while</span> ( (ptr =  strchr(ptr, <span class="charliteral">'\''</span>)) != NULL) {
00821                 ptr[0] = <span class="charliteral">'"'</span>;
00822                 ++ptr;
00823         }
00824         
00825         snprintf(exec, <a class="code" href="parseupdates_8c.html#a95">len</a>, <span class="stringliteral">"echo '%s' | mail -r '%s' -s '%s' '%s'"</span>, msg_c, from, subject_c, to);
00826         
00827         system(exec);
00828         
00829         g_free(msg_c);
00830         g_free(subject_c);
00831 }
00832 
00833 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00834"></a><a class="code" href="luau_8c.html#a3">00834</a> <a class="code" href="parseupdates_8c.html#a41">MSG</a>(<span class="keywordtype">int</span> level, <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">template</span>, ...) {
00835         <span class="keywordtype">char</span> *msg;
00836         va_list <a class="code" href="luau_8c.html#a11">list</a>;
00837         
00838         va_start(<a class="code" href="luau_8c.html#a11">list</a>, <span class="keyword">template</span>);
00839         
00840         <span class="keywordflow">if</span> (level &lt;= <a class="code" href="luau_8c.html#a0">verbosity</a>) {
00841                 <span class="keywordflow">if</span> (<a class="code" href="luau_8c.html#a1">outputToString</a>) {
00842                         msg = <a class="code" href="util_8c.html#a7">lutil_valistToString</a>(<span class="keyword">template</span>, <a class="code" href="luau_8c.html#a11">list</a>);
00843                         g_string_append(<a class="code" href="luau_8c.html#a2">outputString</a>, msg);
00844                         g_free(msg);
00845                 } <span class="keywordflow">else</span> {
00846                         vprintf(<span class="keyword">template</span>, <a class="code" href="luau_8c.html#a11">list</a>);
00847                 }
00848         }
00849 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Dec 24 06:31:15 2003 for luau by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.2 </small></address>
</body>
</html>
