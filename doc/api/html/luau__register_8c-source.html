<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>luau: luau_register.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.2 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a></div>
<h1>luau_register.c</h1><div class="fragment"><pre>00001 <span class="comment">/*</span>
00002 <span class="comment"> * luau (Lib Update/Auto-Update): Simple Update Library</span>
00003 <span class="comment"> * Copyright (C) 2003  David Eklund</span>
00004 <span class="comment"> *</span>
00005 <span class="comment"> * - This library is free software; you can redistribute it and/or             -</span>
00006 <span class="comment"> * - modify it under the terms of the GNU Lesser General Public                -</span>
00007 <span class="comment"> * - License as published by the Free Software Foundation; either              -</span>
00008 <span class="comment"> * - version 2.1 of the License, or (at your option) any later version.        -</span>
00009 <span class="comment"> * -                                                                           -</span>
00010 <span class="comment"> * - This library is distributed in the hope that it will be useful,           -</span>
00011 <span class="comment"> * - but WITHOUT ANY WARRANTY; without even the implied warranty of            -</span>
00012 <span class="comment"> * - MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU         -</span>
00013 <span class="comment"> * - Lesser General Public License for more details.                           -</span>
00014 <span class="comment"> * -                                                                           -</span>
00015 <span class="comment"> * - You should have received a copy of the GNU Lesser General Public          -</span>
00016 <span class="comment"> * - License along with this library; if not, write to the Free Software       -</span>
00017 <span class="comment"> * - Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA -</span>
00018 <span class="comment"> */</span>
00019 
00020 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00021 <span class="preprocessor">#include &lt;unistd.h&gt;</span>
00022 <span class="preprocessor">#include &lt;getopt.h&gt;</span>
00023 <span class="preprocessor">#include &lt;malloc.h&gt;</span>
00024 <span class="preprocessor">#include &lt;string.h&gt;</span>
00025 
00026 <span class="preprocessor">#include &lt;glib.h&gt;</span>
00027 
00028 <span class="preprocessor">#include "<a class="code" href="libuau_8h.html">libuau.h</a>"</span>
00029 <span class="preprocessor">#include "<a class="code" href="util_8h.html">util.h</a>"</span>
00030 
00031 <span class="preprocessor">#ifdef WITH_DMALLOC</span>
00032 <span class="preprocessor"></span><span class="preprocessor">#  include &lt;dmalloc.h&gt;</span>
00033 <span class="preprocessor">#endif</span>
00034 <span class="preprocessor"></span>
00035 
00036 <span class="keyword">static</span> <span class="keywordtype">void</span> printUsage(<span class="keywordtype">void</span>);
00037 <span class="keyword">static</span> <span class="keyword">struct </span>option* getLongOptions();
00038 
00039 <span class="keywordtype">int</span>
00040 main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[]) {
00041         <span class="keyword">struct </span>option *longOptions = getLongOptions();
00042         <span class="keywordtype">char</span> *url = NULL, *version = NULL, *program;
00043         <a class="code" href="structADate.html">ADate</a> *date = NULL;
00044         <span class="keywordtype">int</span> c;
00045         
00046         <span class="keywordflow">if</span> (argc == 1) {
00047                 printUsage();
00048                 g_free(longOptions);
00049                 exit(0);
00050         }
00051         
00052         <span class="keywordflow">while</span> ((c = getopt_long(argc, argv, <span class="stringliteral">":u:d:v:h"</span>, longOptions, NULL)) != -1) {
00053                 <span class="keywordflow">switch</span> (c) {
00054                         <span class="keywordflow">case</span> <span class="charliteral">'u'</span>:
00055                                 url = g_strdup(optarg);
00056                                 <span class="keywordflow">break</span>;
00057                         <span class="keywordflow">case</span> <span class="charliteral">'d'</span>:
00058                                 date = luau_parseDate(optarg);
00059                                 <span class="keywordflow">break</span>;
00060                         <span class="keywordflow">case</span> <span class="charliteral">'v'</span>:
00061                                 version = g_strdup(optarg);
00062                                 <span class="keywordflow">break</span>;
00063                         <span class="keywordflow">case</span> <span class="charliteral">'h'</span>:
00064                                 printUsage();
00065                                 g_free(longOptions);
00066                                 exit(0);
00067                         <span class="keywordflow">case</span> <span class="charliteral">'?'</span>:
00068                                 printf(<span class="stringliteral">"Invalid option: -%c\n"</span>, optopt);
00069                                 printUsage();
00070                                 g_free(longOptions);
00071                                 exit(1);
00072                         <span class="keywordflow">case</span> <span class="charliteral">':'</span>:
00073                                 printf(<span class="stringliteral">"Argument needed for -%c\n"</span>, optopt);
00074                                 printUsage();
00075                                 g_free(longOptions);
00076                                 exit(1);
00077                         <span class="keywordflow">default</span>:
00078                                 printf(<span class="stringliteral">"Unknown error: got character code 0%o\n"</span>, c);
00079                                 printUsage();
00080                                 g_free(longOptions);
00081                                 exit(1);
00082                 }
00083         }
00084         
00085         g_free(longOptions);
00086         
00087         <span class="keywordflow">if</span> (argc == optind+1) {
00088                 program = argv[optind];
00089                 printf(<span class="stringliteral">"Registering %s (%d)... \n"</span>, program, strlen(program));
00090                 luau_registerNewApp(program, version, date, url, NULL);
00091                 printf(<span class="stringliteral">"Done.\n"</span>);
00092         } <span class="keywordflow">else</span> {
00093                 <span class="keywordflow">if</span> (argc == optind)
00094                         printf(<span class="stringliteral">"ERROR: No program name specified\n"</span>);
00095                 <span class="keywordflow">else</span> <span class="comment">/* argc &gt; optind + 1 */</span>
00096                         printf(<span class="stringliteral">"ERROR: Too many arguments\n"</span>);
00097                 
00098                 printUsage();
00099                 exit(1);
00100         }
00101         
00102         g_free(url);
00103         g_free(date);
00104         
00105         <span class="keywordflow">return</span> 0;
00106 }
00107 
00108 <span class="keyword">static</span> <span class="keywordtype">void</span>
00109 printUsage(<span class="keywordtype">void</span>) {
00110         printf(<span class="stringliteral">"Usage: luau_register [OPTION] ... program_name\n"</span>);
00111         printf(<span class="stringliteral">"\n"</span>);
00112         printf(<span class="stringliteral">"Register a program with the specified details in the luau database.\n"</span>);
00113         printf(<span class="stringliteral">"\n"</span>);
00114         printf(<span class="stringliteral">"Options:\n"</span>);
00115         printf(<span class="stringliteral">"  -u, --url=LOCATION                 location of luau updates file\n"</span>);
00116         printf(<span class="stringliteral">"  -d, --date=\"MM/DD/YYYY HH:MM:SS\"   date of this program version's release\n"</span>);
00117         printf(<span class="stringliteral">"  -v, --version=VERSION              installed version of this program\n"</span>);
00118         printf(<span class="stringliteral">"  -h, --help                         display this message\n"</span>);
00119         printf(<span class="stringliteral">"\n"</span>);
00120         printf(<span class="stringliteral">"  Note that both the server and the FTP directory must be set for luau\n"</span>);
00121         printf(<span class="stringliteral">"  to work at for any given program.  The date is required for the versioning\n"</span>);
00122         printf(<span class="stringliteral">"  scheme to work.\n"</span>);
00123         printf(<span class="stringliteral">"\n"</span>);
00124 }
00125 
00126 <span class="keyword">static</span> <span class="keyword">struct </span>option *
00127 getLongOptions() {
00128         <span class="keyword">struct </span>option *options = (<span class="keyword">struct </span>option *) calloc(6, sizeof(struct option));
00129         
00130         options[0].name = <span class="stringliteral">"url"</span>;
00131         options[0].has_arg = 1;
00132         options[0].flag = NULL;
00133         options[0].val = <span class="charliteral">'u'</span>;
00134         
00135         options[2].name = <span class="stringliteral">"date"</span>;
00136         options[2].has_arg = 1;
00137         options[2].flag = NULL;
00138         options[2].val = <span class="charliteral">'d'</span>;
00139         
00140         options[1].name = <span class="stringliteral">"version"</span>;
00141         options[1].has_arg = 1;
00142         options[1].flag = NULL;
00143         options[1].val = <span class="charliteral">'v'</span>;
00144         
00145         options[3].name = <span class="stringliteral">"help"</span>;
00146         options[3].has_arg = 0;
00147         options[3].flag = NULL;
00148         options[3].val = <span class="charliteral">'h'</span>;
00149         
00150         memset(&amp;options[4], 0, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> option));
00151         
00152         <span class="keywordflow">return</span> options;
00153 }
00154         
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Sep 30 23:05:59 2003 for luau by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.2 </small></address>
</body>
</html>
